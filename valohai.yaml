- step:
    name: load-data
    image: nvcr.io/nvidia/clara/bionemo-framework:1.3
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - pip install -r requirements.txt
      - python prepare-data.py
- step:
    name: predict-properties
    image: nvcr.io/nvidia/clara/bionemo-framework:nightly
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - pip install -r requirements.txt
      - python predict-properties.py
    environment-variables:
      - name: WORK_DIR
        default: "/valohai/outputs/esm2_inference_tutorial"
        description: Working directory for the inference step
    inputs:
      - name: dataset
        default: "datum://0198ec30-9989-43b3-e4ed-992a3b1a6d9f"
    parameters:
      - name: num_gpus
        type: integer
        default: 1
      - name: precision
        type: string
        default: fp16
      - name: micro-batch-size
        type: integer
        default: 8
- step:
    name: generate-proteins
    image: nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - apt-get update && apt-get install -y python3-pip
      - pip3 install torch==2.7.1+cu118 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
      - pip3 install -r requirements.txt
      - python3 generate-proteins.py
    environment-variables:
      - name: WORK_DIR
        default: "/valohai/outputs/protein_generation"
        description: Working directory for the generation step
    parameters:
      - name: max_length
        type: integer
        default: 100
      - name: top_k
        type: integer
        default: 950
      - name: repetition_penalty
        type: float
        default: 1.2
      - name: num_return_sequences
        type: integer
        default: 10
      - name: eos_token_id
        type: integer
        default: 0
- step:
    name: evaluate-generated
    image: nvidia/cuda:11.8.0-cudnn8-runtime-ubuntu22.04
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - apt-get update && apt-get install -y python3-pip
      - pip3 install torch==2.7.1+cu118 torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118
      - pip3 install -r requirements.txt
      - python3 evaluate-generated.py
    environment-variables:
      - name: WORK_DIR
        default: "/valohai/outputs/evaluate_generated"
        description: Working directory for the generation step
    inputs:
      - name: sequences
        default: "datum://01993303-06cb-3ff9-30b6-a78467ddd67b"
- step:
    name: visualize-similarity
    image: docker.io/python:3.10
    environment: pro-trial-prod-oci-vm-gpu-a10-1
    command:
      - pip install torch pandas scikit-learn matplotlib valohai-utils
      - python protein-similarity-visualization.py
    inputs:
      - name: embeddings
        default: "datum://01993283-53bf-e659-b9df-d77062d76d84"
    parameters:
      - name: query_idx
        type: integer
        default: 0
      - name: topk
        type: integer
        default: 20
